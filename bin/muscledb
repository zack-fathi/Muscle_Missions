#!/bin/bash

set -Eeuo pipefail

# Get the absolute path of the script directory
SCRIPT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" &>/dev/null && pwd)"

DB_DIR="${SCRIPT_DIR}/../var"
DB_FILE="${DB_DIR}/muscle.sqlite3"
SCHEMA_SCRIPT="${SCRIPT_DIR}/../sql/schema.sql"
SQL_SCRIPT="${SCRIPT_DIR}/../sql/data.sql"

create_db() {
    if [ -f "${DB_FILE}" ]; then
        echo "Error: database already exists"
        exit 1
    fi
    echo "Creating database ..."
    mkdir -p "${DB_DIR}"
    sqlite3 "${DB_FILE}" < "${SCHEMA_SCRIPT}"
    sqlite3 "${DB_FILE}" < "${SQL_SCRIPT}"
}

destroy_db() {
    echo "Destroying database ..."
    rm -f "${DB_FILE}"
}

reset_db() {
    echo "Resetting database ..."
    rm -f "${DB_FILE}"
    mkdir -p "${DB_DIR}"
    sqlite3 "${DB_FILE}" < "${SQL_SCRIPT}"
}

case "$1" in
    create)
        create_db
        ;;
    destroy)
        destroy_db
        ;;
    reset)
        reset_db
        ;;
    *)
        echo "Usage: $0 {create|destroy|reset}"
        exit 1
esac
